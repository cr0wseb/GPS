<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Flèche de Navigation GPS</title>
    <style>
        #arrow {
            width: 100px;
            height: 100px;
            background: url('https://cdn3.iconfinder.com/data/icons/faticons/32/arrow-up-01-512.png') no-repeat center;
            background-size: contain;
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body>
    <div id="arrow"></div>
    <script>
        const targetCoords = { latitude: 48.8584, longitude: 2.2945 }; // Coordonnées de la cible (Tour Eiffel)
        
        let currentCoords = null;
        let currentHeading = null;

        if ('geolocation' in navigator && 'DeviceOrientationEvent' in window) {
            navigator.geolocation.watchPosition(updatePosition, showError, { enableHighAccuracy: true });

            window.addEventListener('deviceorientationabsolute' in window ? 'deviceorientationabsolute' : 'deviceorientation', event => {
                if (event.absolute || event.webkitCompassHeading !== undefined) {
                    currentHeading = event.alpha || event.webkitCompassHeading;
                }
                updateArrow();
            });

        } else {
            alert('Votre appareil ne supporte pas la géolocalisation ou les événements d\'orientation.');
        }

        function updatePosition(position) {
            currentCoords = {
                latitude: position.coords.latitude,
                longitude: position.coords.longitude
            };
            updateArrow();
        }

        function showError(error) {
            console.error('Erreur de géolocalisation: ', error);
        }

        function updateArrow() {
            if (currentCoords && currentHeading !== null) {
                const bearing = calculateBearing(currentCoords, targetCoords);
                const arrow = document.getElementById('arrow');
                arrow.style.transform = `rotate(${bearing - currentHeading}deg)`;
            }
        }

        function calculateBearing(startCoords, destCoords) {
            const startLat = degreesToRadians(startCoords.latitude);
            const startLng = degreesToRadians(startCoords.longitude);
            const destLat = degreesToRadians(destCoords.latitude);
            const destLng = degreesToRadians(destCoords.longitude);

            const y = Math.sin(destLng - startLng) * Math.cos(destLat);
            const x = Math.cos(startLat) * Math.sin(destLat) -
                      Math.sin(startLat) * Math.cos(destLat) * Math.cos(destLng - startLng);

            const bearing = radiansToDegrees(Math.atan2(y, x));
            return (bearing + 360) % 360; // Normalisation à 0-360
        }

        function degreesToRadians(degrees) {
            return degrees * Math.PI / 180;
        }

        function radiansToDegrees(radians) {
            return radians * 180 / Math.PI;
        }
    </script>
</body>
</html>
